{% extends "labour_management/base.html" %}
{% load dict_extras %}
{% block title %}Holiday Rota{% endblock %}

{% block content %}
<div class="container py-4">
  <h1>Holiday Rota (next {{ dates|length }} days)</h1>
  <a href="{% url 'holidays_index' %}" class="btn btn-secondary btn-sm">Refresh</a>
  <a href="{% url 'holidays_requests' %}" class="btn btn-primary btn-sm">Requests</a>
  <div style="overflow:auto;">
    <table class="table table-bordered">
      <thead>
        <tr>
          <th class="sticky-col" style="left:0; z-index:3;">GPID</th>
          <th class="sticky-col" style="left:80px; z-index:3;">Name</th>
          <th class="sticky-col" style="left:240px; z-index:3;">Shift</th>
          <th class="sticky-col" style="left:320px; z-index:3;">Area</th>
          <th class="sticky-col" style="left:400px; z-index:3;">Role</th>
          {% for d in dates %}
            <th>{{ d|date:"j/M" }}</th>
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for e in employees %}
          <tr>
            <td class="sticky-col" style="left:0;">{{ e.gpid }}</td>
            <td class="sticky-col" style="left:80px;">{{ e.full_name }}</td>
            <td class="sticky-col" style="left:240px;">{{ e.shift }}</td>
            <td class="sticky-col" style="left:320px;">{{ e.area }}</td>
            <td class="sticky-col" style="left:400px;">{{ e.role }}</td>

            {# first grab the row for this employee #}
            {% with matrix|get_item:e.id as row %}
              {% for d in dates %}
                {# then grab the status for this date #}
                {% with row|get_item:d as stat %}
                  <td>
                    {% if stat %}
                      <span class="badge badge-pill
                        {% if stat == 'Approved' or stat == 'Holiday' %}
                          badge-success
                        {% else %}
                          badge-warning
                        {% endif %}
                      ">
                        {{ stat }}
                      </span>
                    {% endif %}
                  </td>
                {% endwith %}
              {% endfor %}
            {% endwith %}
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
